# Matrix Working Demo
# Shows matrix execution with proper variable usage
version: 1.0

env:
  PROJECT: "matrix-test"

recipes:
  # Matrix with proper variable usage
  test-matrix:
    help: "Test matrix with working variables"
    matrix:
      os: ["ubuntu", "macos", "windows"]
      version: ["16", "18", "20"]
    run: |
      {{ step "Testing on {{ .matrix_os }} with Node.js {{ .matrix_version }}" }}
      
      echo "Configuration:"
      echo "  OS: {{ .matrix_os }}"
      echo "  Version: {{ .matrix_version }}"
      echo "  Project: $PROJECT"
      
      # OS-specific behavior
      {{ if eq .matrix_os "windows" }}
      echo "  Platform: Windows detected"
      echo "  Using PowerShell commands"
      {{ else if eq .matrix_os "macos" }}
      echo "  Platform: macOS detected"  
      echo "  Using BSD commands"
      {{ else }}
      echo "  Platform: Linux detected"
      echo "  Using GNU commands"
      {{ end }}
      
      # Version-specific behavior
      {{ if eq .matrix_version "16" }}
      echo "  Node.js: Legacy version (16.x)"
      {{ else if eq .matrix_version "20" }}
      echo "  Node.js: Latest LTS (20.x)"
      {{ else }}
      echo "  Node.js: Standard version ({{ .matrix_version }}.x)"
      {{ end }}
      
      {{ success "Matrix combination {{ .matrix_os }}/{{ .matrix_version }} completed" }}

  # Matrix with dependencies
  build-matrix:
    help: "Build matrix with dependencies"
    matrix:
      arch: ["amd64", "arm64"]
    deps: [setup]
    run: |
      {{ step "Building for {{ .matrix_arch }} architecture" }}
      
      BUILD_TARGET="{{ .matrix_arch }}"
      echo "Architecture: $BUILD_TARGET"
      
      {{ if eq .matrix_arch "arm64" }}
      echo "Configuring for ARM64 build"
      echo "Using cross-compilation tools"
      {{ else }}
      echo "Configuring for AMD64 build"
      echo "Using native compilation"
      {{ end }}
      
      {{ success "Build for {{ .matrix_arch }} completed" }}

  setup:
    help: "Setup build environment"
    run: |
      {{ step "Setting up build environment" }}
      echo "Installing build tools..."
      {{ success "Setup completed" }}

  # Show matrix expansion
  matrix-info:
    help: "Show matrix expansion information"
    run: |
      {{ step "Matrix Expansion Information" }}
      echo "================================"
      echo ""
      
      echo "test-matrix expands to:"
      echo "  ubuntu/16, ubuntu/18, ubuntu/20"
      echo "  macos/16, macos/18, macos/20"  
      echo "  windows/16, windows/18, windows/20"
      echo "  Total: 9 combinations"
      echo ""
      
      echo "build-matrix expands to:"
      echo "  amd64, arm64"
      echo "  Total: 2 combinations"
      echo ""
      
      {{ success "Matrix information displayed" }}
