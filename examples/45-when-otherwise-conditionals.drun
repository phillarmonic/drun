# When-Otherwise Conditional Logic Examples
# Built with drun v2 - https://github.com/phillarmonic/drun
version: 2.0

project "conditional-demo" version "1.0":
	set supported_platforms as list to ["windows", "linux", "darwin"]
	set build_modes as list to ["debug", "release"]
	set deployment_envs as list to ["dev", "staging", "production"]

task "basic conditionals" means "Demonstrate basic when-otherwise syntax":
	info "ğŸ”€ Basic When-Otherwise Conditional Examples"
	
	let $platform = "windows"
	info "Current platform: {$platform}"
	
	when $platform is "windows":
		info "âœ… Windows platform detected"
		step "Using Windows-specific build commands"
		step "Setting up .exe file extensions"
	otherwise:
		info "âœ… Unix-like platform detected"
		step "Using Unix build commands"
		step "No file extension needed"
	
	success "ğŸ‰ Basic conditional logic completed"

task "negation conditionals" means "Demonstrate when-otherwise with negation":
	info "ğŸš« When-Otherwise with Negation Examples"
	
	let $environment = "development"
	info "Current environment: {$environment}"
	
	when $environment is not "production":
		info "âœ… Non-production environment"
		step "Using development settings"
		step "Enabling debug logging"
		step "Skipping security hardening"
	otherwise:
		info "âœ… Production environment detected"
		step "Using production settings"
		step "Enabling security hardening"
		step "Disabling debug features"
	
	let $feature_flag = ""
	info "Feature flag value: '{$feature_flag}'"
	
	when $feature_flag is not empty:
		info "âœ… Feature flag is set: {$feature_flag}"
		step "Enabling feature: {$feature_flag}"
	otherwise:
		info "âœ… No feature flag set"
		step "Using default feature set"
	
	success "ğŸ‰ Negation conditional logic completed"

task "nested conditionals" means "Demonstrate nested when-otherwise logic":
	info "ğŸ”— Nested When-Otherwise Examples"
	
	let $os = "windows"
	let $arch = "arm64"
	
	info "Building for OS: {$os}, Architecture: {$arch}"
	
	when $os is "windows":
		info "ğŸªŸ Windows build process"
		when $arch is "amd64":
			step "Building Windows x64 binary"
			step "Using x64 optimizations"
		otherwise:
			step "Building Windows ARM64 binary"
			step "Using ARM64 optimizations"
		step "Adding .exe extension"
	otherwise:
		info "ğŸ§ Unix-like build process"
		when $os is "darwin":
			step "Building macOS binary"
			step "Code signing for macOS"
		otherwise:
			step "Building Linux binary"
			step "Creating AppImage package"
		step "Setting executable permissions"
	
	success "ğŸ‰ Nested conditional logic completed"

task "matrix conditionals" means "Demonstrate when-otherwise in matrix execution":
	info "ğŸŒ Matrix Execution with When-Otherwise"
	
	for each $platform in $globals.supported_platforms:
		info "ğŸ“¦ Processing platform: {$platform}"
		
		for each $mode in $globals.build_modes:
			info "  ğŸ”§ Build mode: {$mode}"
			
			when $platform is "windows":
				when $mode is "debug":
					step "Building Windows debug binary with symbols"
					step "Output: app-{$platform}-{$mode}.exe"
				otherwise:
					step "Building Windows release binary (optimized)"
					step "Output: app-{$platform}-{$mode}.exe"
			otherwise:
				when $mode is "debug":
					step "Building {$platform} debug binary with symbols"
					step "Output: app-{$platform}-{$mode}"
				otherwise:
					step "Building {$platform} release binary (optimized)"
					step "Output: app-{$platform}-{$mode}"
	
	success "ğŸ‰ Matrix conditional logic completed"

task "deployment conditionals" means "Demonstrate deployment logic with conditionals":
	info "ğŸš€ Deployment Conditional Logic"
	
	for each $env in $globals.deployment_envs:
		info "ğŸŒ Deploying to environment: {$env}"
		
		when $env is "production":
			info "ğŸ”’ Production deployment - extra security"
			step "Running security scans"
			step "Requiring manual approval"
			step "Creating backup before deployment"
			step "Deploying with zero-downtime strategy"
			step "Running smoke tests"
		otherwise:
			when $env is "staging":
				info "ğŸ§ª Staging deployment - testing focus"
				step "Running full test suite"
				step "Deploying with test data"
				step "Enabling debug features"
			otherwise:
				info "ğŸ› ï¸ Development deployment - fast iteration"
				step "Skipping tests for speed"
				step "Hot-reloading enabled"
				step "Debug mode active"
	
	success "ğŸ‰ Deployment conditional logic completed"

task "error handling conditionals" means "Demonstrate error handling with conditionals":
	info "âš ï¸ Error Handling with When-Otherwise"
	
	let $service_status = "unhealthy"
	let $retry_count = "3"
	
	when $service_status is not "healthy":
		info "ğŸš¨ Service is not healthy: {$service_status}"
		
		when $retry_count is not "0":
			info "ğŸ”„ Attempting recovery (retries left: {$retry_count})"
			step "Restarting service"
			step "Checking health endpoint"
			step "Updating load balancer"
		otherwise:
			info "ğŸ’¥ Max retries exceeded"
			step "Alerting operations team"
			step "Switching to backup service"
			step "Creating incident report"
	otherwise:
		info "âœ… Service is healthy"
		step "Continuing normal operations"
	
	success "ğŸ‰ Error handling conditional logic completed"

task "comprehensive demo" means "Run all conditional examples":
	info "ğŸ¯ Running Comprehensive When-Otherwise Demo"
	
	run "drun basic conditionals"
	run "drun negation conditionals" 
	run "drun nested conditionals"
	run "drun matrix conditionals"
	run "drun-cli deployment conditionals"
	run "drun error handling conditionals"
	
	success "ğŸŒŸ All when-otherwise examples completed successfully!"
