# Namespacing Demo
# This example demonstrates recipe namespacing to prevent collisions

version: 1.0

# Global variables
vars:
  project_name: "namespacing-demo"
  version: 1.0.0

# Include files with namespacing to prevent recipe name collisions
include:
  # Local includes with namespacing
  - "docker::shared/docker-common.yml"    # Recipes become docker:build, docker:push, etc.
  
  # You can also include without namespacing (recipes merge directly)
  - "shared/docker-common.yml"            # Recipes merge directly into main namespace
  
  # Remote includes also support namespacing
  # - "k8s::https://example.com/kubernetes-tasks.yml"
  # - "ci::git+https://github.com/company/ci-recipes.git@main"

# Recipe-Prerun setup
recipe-prerun:
  - |
    # Colors
    RED='\033[0;31m'
    GREEN='\033[0;32m'
    YELLOW='\033[1;33m'
    BLUE='\033[0;34m'
    NC='\033[0m'
    
    log_info() { echo -e "${BLUE}‚ÑπÔ∏è  $1${NC}"; }
    log_success() { echo -e "${GREEN}‚úÖ $1${NC}"; }
    log_warning() { echo -e "${YELLOW}‚ö†Ô∏è  $1${NC}"; }

# Recipe-Postrun cleanup
recipe-postrun:
  - |
    # Log completion status for each recipe
    if [ $? -eq 0 ]; then
      log_success "Recipe execution completed"
    else
      log_warning "Recipe execution had issues"
    fi

# Before blocks
before:
  - |
    echo -e "${BLUE}üöÄ Namespacing Demo Starting${NC}"
    log_info "This demo shows how namespacing prevents recipe collisions"

# After blocks  
after:
  - |
    echo -e "${GREEN}‚úÖ Namespacing Demo Completed${NC}"

# Local recipes (no namespace prefix)
recipes:
  # This is a local recipe
  build:
    help: "Local build recipe"
    run: |
      log_info "Running LOCAL build recipe"
      echo "This is the main/local build recipe"
      echo "It coexists with docker:build from the included file"

  # Show all available recipes
  list-recipes:
    help: "List all available recipes (local and namespaced)"
    run: |
      log_info "Available recipes in this demo:"
      echo ""
      echo "Local recipes:"
      echo "  build           - Local build recipe (this one)"
      echo "  list-recipes    - This recipe"
      echo "  demo-namespace  - Demonstrate namespace usage"
      echo ""
      echo "Namespaced recipes (from docker:: namespace):"
      echo "  docker:build    - Docker build recipe"
      echo "  docker:push     - Docker push recipe"
      echo "  docker:clean    - Docker cleanup recipe"
      echo ""
      echo "Usage examples:"
      echo "  drun build          # Runs the local build"
      echo "  drun docker:build   # Runs the Docker build"
      echo "  drun docker:push    # Runs the Docker push"

  # Demonstrate calling namespaced recipes
  demo-namespace:
    help: "Demonstrate calling namespaced recipes"
    run: |
      log_info "This recipe demonstrates namespace usage"
      echo ""
      echo "1. First, let's run the local build:"
      echo "   (This would be: drun build)"
      echo ""
      echo "2. Then we could run the Docker build:"
      echo "   (This would be: drun docker:build)"
      echo ""
      echo "3. Finally, we could push the Docker image:"
      echo "   (This would be: drun docker:push)"
      echo ""
      log_warning "Note: Dependencies can reference namespaced recipes too!"
      echo "Example: deps: ['docker:build', 'local-recipe']"

  # Recipe that depends on a namespaced recipe
  full-build:
    help: "Build everything (depends on both local and namespaced recipes)"
    deps: ["build", "docker:build"]  # Depends on both local and namespaced recipes
    run: |
      log_success "Full build completed!"
      log_info "This recipe ran after both 'build' and 'docker:build'"

  # Recipe showing namespace in variables/templates
  show-info:
    help: "Show information about available recipes"
    run: |
      log_info "Recipe information:"
      echo ""
      echo "Current recipe: show-info (local)"
      echo "Project: {{ .project_name }}"
      echo "Version: {{ .version }}"
      echo ""
      echo "Available namespaces in this configuration:"
      echo "  (main)    - Local recipes defined in this file"
      echo "  docker:   - Docker-related recipes from shared/docker-common.yml"
      echo ""
      echo "Benefits of namespacing:"
      echo "  ‚úÖ Prevents recipe name collisions"
      echo "  ‚úÖ Clear organization by source/purpose"
      echo "  ‚úÖ Easy to see which file a recipe comes from"
      echo "  ‚úÖ Supports both local and remote includes"
