# Includes Demo
# Demonstrates local file includes (remote includes would be added later)
version: 0.1

# Include shared recipes
include:
  - "shared/docker-common.yml"

env:
  APP_NAME: "my-demo-app"
  VERSION: "{{ gitShortCommit }}"

recipes:
  # Use recipes from included file
  info:
    help: "Show app and Docker info"
    deps: [docker-info]  # This comes from shared/docker-common.yml
    run: |
      {{ step "Application Information" }}
      echo "App Name: $APP_NAME"
      echo "Version: $VERSION"
      echo "Git Branch: {{ gitBranch }}"
      {{ success "App info displayed" }}

  # Override or extend included recipes
  build:
    help: "Build application with Docker cleanup"
    deps: [docker-cleanup]  # Clean before building
    run: |
      {{ step "Building $APP_NAME:$VERSION" }}
      
      # Use the auto-detected buildx command from included file
      $DOCKER_BUILDX_CMD build \
        --tag "$APP_NAME:$VERSION" \
        --tag "$APP_NAME:latest" \
        .
      
      {{ success "Build completed" }}

  # Local recipe that uses included snippets
  deploy:
    help: "Deploy application"
    deps: [build]
    run: |
      {{ step "Deploying $APP_NAME:$VERSION" }}
      
      # Use snippet from included file
      {{ snippet "docker_check" }}
      
      # Deploy logic here
      echo "Deploying $APP_NAME:$VERSION..."
      
      {{ success "Deployment completed" }}
